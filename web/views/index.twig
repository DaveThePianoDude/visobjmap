{% extends "layout.html" %}
{% block content %}

<div class="jumbotron text-center">
  <div class="container">
    <h1>Visual Object Mapper</h1>
  </div>
</div>
<div class="container">
	  <hr>
	  <div class="row">
			<div class="col-xs-6">
				<div id="containerSource" style="height: 30px;">
					<input type="file" id="sourceFile" name="file" />
				</div>
			</div>
			<div class="col-xs-6">
				<div id="containerDest" style="height: 30px;">
					<input type="file" id="destFile" name="file" />
				</div>        
			</div>
	  </div>
	  <div class="row">
		<canvas id="layer1" height="400" style="position: absolute; left: 0; top: 500; z-index: 0;"></canvas>
		<canvas id="layer2" height="400" style="position: absolute; left: 0; top: 500; z-index: 1;"></canvas>
	  </div>
</div>

<script lang="javascript">

	var leftMargin = 10;
	var topMargin = 20;
	
	var wordCanvas = document.getElementById("layer2");
	wordCanvas.style.backgroundColor = 'rgba(158, 167, 184, 0.2)';
	wordCanvas.width = window.innerWidth - leftMargin * 2;
	var wordContext = wordCanvas.getContext("2d");
	
	//var drawCanvas = document.getElementById("layer1");
	//drawCanvas.width = window.innerWidth - leftMargin * 2;
	//var drawContext = drawCanvas.getContext("2d");
	
	var declTokenStr = "privatestring";
	
	function handleFileSelect(evt)
	{
	    var files = evt.target.files; // FileList object
	
	    // Loop through the FileList and render image files as thumbnails.
	    for (var i = 0, f; f = files[i]; i++)
	    {
	        var reader = new FileReader();
	        reader.onload = (function(reader)
	        {
	            return function()
	            {
	                var contents = reader.result;
	                contents = contents.replace(/ /g,'')
					var res = contents.match(/privatestring\D*;/g); 
					var first = res[0];
					var tokenArray = first.split(';');
					
					var x = $(evt.target).closest("div").offset().left;
					wordContext.fillStyle = "blue";
					wordContext.font = "bold 16px Arial";
					
					for (var j = 0; j < tokenArray.length; j++)
					{
					  console.log (tokenArray[j]);
					  var varName = tokenArray[j].trim();
					  console.log(varName.length);
					  wordContext.fillText(varName.substr(declTokenStr.length), x, topMargin + j*18);
					}   
	            }
	        })(reader);
	
	        reader.readAsText(f);
	    }
	}
	
	
	document.getElementById('sourceFile').addEventListener('change', handleFileSelect, false);
	document.getElementById('destFile').addEventListener('change', handleFileSelect, false);
</script>


{% endblock %}